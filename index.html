<!DOCTYPE html>
<html lang="ta">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ро╡ро┐роХрпНроХро┐роорпАроЯро┐ропро╛ рокроЩрпНроХро│ро┐рокрпНрокрпБ рокроХрпБрокрпНрокро╛ропрпНро╡рпБ роХро░рпБро╡ро┐ - роорпБро┤рпБроорпИропро╛рой рокродро┐рокрпНрокрпБ</title>
    <style>
        :root {
            --primary: #1a237e;
            --primary-light: #534bae;
            --primary-dark: #000051;
            --secondary: #ff6d00;
            --accent: #00bfa5;
            --text: #202122;
            --text-light: #54595d;
            --background: #f8f9fa;
            --card-bg: #ffffff;
            --border: #a2a9b1;
            --success: #2e7d32;
            --error: #c62828;
            --warning: #f57c00;
            --info: #0288d1;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', 'Nirmala UI', 'Latha', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--text);
            background: linear-gradient(135deg, #f5f7fa 0%, #e3e8f0 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: var(--card-bg);
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            padding: 25px 30px;
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23000051' fill-opacity='0.05' fill-rule='evenodd'/%3E%3C/svg%3E");
            opacity: 0.1;
        }
        
        h1 {
            font-size: 28px;
            margin-bottom: 8px;
            position: relative;
            z-index: 1;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
        }
        
        .subtitle {
            font-size: 16px;
            opacity: 0.95;
            position: relative;
            z-index: 1;
        }
        
        .controls-container {
            padding: 25px 30px;
            background: var(--background);
            border-bottom: 1px solid var(--border);
        }
        
        .input-sections {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 25px;
        }
        
        @media (max-width: 1024px) {
            .input-sections {
                grid-template-columns: 1fr;
            }
        }
        
        .input-section {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .section-title {
            font-size: 18px;
            color: var(--primary);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--secondary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title i {
            font-size: 20px;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 15px;
            transition: all 0.3s;
            background: var(--card-bg);
            color: var(--text);
        }
        
        textarea {
            min-height: 150px;
            resize: vertical;
            font-family: monospace;
            line-height: 1.5;
        }
        
        input:focus, textarea:focus, select:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(26, 35, 126, 0.15);
        }
        
        .date-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 25px;
        }
        
        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            min-width: 160px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
        }
        
        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(26, 35, 126, 0.3);
        }
        
        .btn-secondary {
            background: white;
            color: var(--primary);
            border: 2px solid var(--primary);
        }
        
        .btn-secondary:hover:not(:disabled) {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, var(--warning) 0%, #ff9800 100%);
            color: white;
        }
        
        .btn-accent {
            background: linear-gradient(135deg, var(--accent) 0%, #00bcd4 100%);
            color: white;
        }
        
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }
        
        #loading {
            display: none;
            padding: 40px 20px;
            text-align: center;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            margin: 20px 30px;
            border-left: 5px solid var(--primary);
        }
        
        .spinner {
            border: 4px solid rgba(26, 35, 126, 0.1);
            border-left-color: var(--primary);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .status-message {
            padding: 15px 20px;
            border-radius: 8px;
            margin: 0 30px 20px;
            display: none;
            animation: slideIn 0.3s;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .status-success {
            background: #e8f5e9;
            border-left: 5px solid var(--success);
            color: #1b5e20;
        }
        
        .status-error {
            background: #ffebee;
            border-left: 5px solid var(--error);
            color: #b71c1c;
        }
        
        .status-info {
            background: #e3f2fd;
            border-left: 5px solid var(--info);
            color: #0d47a1;
        }
        
        .status-warning {
            background: #fff3e0;
            border-left: 5px solid var(--warning);
            color: #e65100;
        }
        
        #results {
            padding: 0 30px 30px;
        }
        
        .help-box {
            background: #e8f4fd;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
            border-left: 5px solid var(--primary);
        }
        
        .help-box h3 {
            color: var(--primary);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .help-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .help-item {
            background: white;
            padding: 15px;
            border-radius: 6px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        
        .help-item h4 {
            color: var(--primary-light);
            margin-bottom: 8px;
            font-size: 15px;
        }
        
        .help-item ul {
            padding-left: 20px;
            color: var(--text-light);
        }
        
        .help-item li {
            margin-bottom: 5px;
            font-size: 14px;
        }
        
        .participant-count {
            position: absolute;
            top: 25px;
            right: 30px;
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            backdrop-filter: blur(10px);
            z-index: 1;
        }
        
        .preset-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px;
        }
        
        .preset-btn {
            padding: 6px 12px;
            background: white;
            border: 1px solid var(--primary);
            border-radius: 4px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .preset-btn:hover {
            background: var(--primary);
            color: white;
        }
        
        .auto-extract-options {
            display: flex;
            gap: 15px;
            margin-top: 15px;
        }
        
        .option-btn {
            flex: 1;
            padding: 10px;
            background: white;
            border: 2px solid var(--border);
            border-radius: 6px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
        }
        
        .option-btn:hover {
            border-color: var(--primary);
            background: #f0f3ff;
        }
        
        .option-btn.active {
            border-color: var(--primary);
            background: var(--primary);
            color: white;
        }
        
        .participant-list {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 10px;
            background: white;
            margin-top: 10px;
        }
        
        .participant-item {
            padding: 8px 12px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .participant-item:last-child {
            border-bottom: none;
        }
        
        .remove-participant {
            color: var(--error);
            background: none;
            border: none;
            cursor: pointer;
            font-size: 18px;
            padding: 0 5px;
        }
        
        .example-text {
            font-size: 12px;
            color: var(--text-light);
            margin-top: 5px;
            font-style: italic;
        }
        
        .user-input-methods {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .method-tab {
            padding: 10px 20px;
            background: white;
            border: 2px solid var(--border);
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }
        
        .method-tab.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .input-method-content {
            display: none;
        }
        
        .input-method-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .stats-preview {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border-left: 4px solid var(--primary);
        }
        
        .stats-preview h4 {
            color: var(--primary);
            margin-bottom: 10px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
        }
        
        .stat-preview {
            text-align: center;
            padding: 10px;
            background: white;
            border-radius: 6px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .stat-preview .value {
            font-size: 20px;
            font-weight: bold;
            color: var(--primary);
        }
        
        .stat-preview .label {
            font-size: 12px;
            color: var(--text-light);
        }
        
        /* роЙропро░рпНродро░ ро╡ро┐ро│роХрпНроХрокрпН рокрпЖроЯрпНроЯро┐ */
        .advanced-options {
            background: #fff8e1;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            border-left: 4px solid var(--warning);
        }
        
        .advanced-options h4 {
            color: var(--warning);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }
        
        .checkbox-label input[type="checkbox"] {
            width: 18px;
            height: 18px;
        }
        
        .checkbox-text {
            font-size: 14px;
            color: var(--text);
        }
        
        .info-tooltip {
            display: inline-block;
            width: 16px;
            height: 16px;
            background: var(--info);
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 16px;
            font-size: 12px;
            cursor: help;
            margin-left: 5px;
        }
        
        /* роорпБроЯро┐ро╡рпБ роХро╛роЯрпНроЪро┐ рокро╛рогро┐роХро│рпН */
        .results-container {
            padding: 20px;
        }
        
        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--border);
        }
        
        .results-title {
            color: var(--primary);
            font-size: 24px;
        }
        
        .results-actions {
            display: flex;
            gap: 10px;
        }
        
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }
        
        .results-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .results-card h3 {
            color: var(--primary);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--secondary);
        }
        
        .stats-value {
            font-size: 36px;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 5px;
        }
        
        .stats-label {
            font-size: 14px;
            color: var(--text-light);
        }
        
        .contributor-list {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .contributor-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #eee;
        }
        
        .contributor-item:last-child {
            border-bottom: none;
        }
        
        .contributor-name {
            font-weight: 600;
            color: var(--text);
        }
        
        .contributor-count {
            background: var(--primary);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 14px;
        }
        
        .contributor-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 10px;
        }
        
        .detail-item {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 6px;
            font-size: 13px;
        }
        
        .detail-label {
            color: var(--text-light);
            font-size: 12px;
            margin-bottom: 3px;
        }
        
        .detail-value {
            font-weight: 600;
            color: var(--text);
        }
        
        .project-breakdown {
            margin-top: 20px;
        }
        
        .project-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px dashed #eee;
        }
        
        .project-item:last-child {
            border-bottom: none;
        }
        
        .progress-bar {
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin: 5px 0;
            flex: 1;
            margin-right: 15px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary) 0%, var(--primary-light) 100%);
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        
        .timeline-chart {
            height: 200px;
            margin-top: 20px;
            position: relative;
        }
        
        .chart-bar {
            position: absolute;
            bottom: 0;
            background: linear-gradient(to top, var(--primary), var(--primary-light));
            border-radius: 4px 4px 0 0;
            transition: all 0.3s;
        }
        
        .chart-bar:hover {
            opacity: 0.8;
        }
        
        .chart-label {
            position: absolute;
            bottom: -25px;
            font-size: 11px;
            color: var(--text-light);
            text-align: center;
            transform: rotate(-45deg);
            transform-origin: top left;
        }
        
        .export-section {
            margin-top: 40px;
            padding-top: 30px;
            border-top: 2px solid var(--border);
        }
        
        .export-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        
        .export-btn {
            background: white;
            color: var(--primary);
            border: 2px solid var(--primary);
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
        }
        
        .export-btn:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(26, 35, 126, 0.2);
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .data-table th {
            background: var(--primary);
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }
        
        .data-table td {
            padding: 10px 12px;
            border-bottom: 1px solid #eee;
        }
        
        .data-table tr:nth-child(even) {
            background: #f8f9fa;
        }
        
        .data-table tr:hover {
            background: #e8f4fd;
        }
        
        .badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-right: 5px;
        }
        
        .badge-primary {
            background: var(--primary);
            color: white;
        }
        
        .badge-success {
            background: var(--success);
            color: white;
        }
        
        .badge-warning {
            background: var(--warning);
            color: white;
        }
        
        .badge-info {
            background: var(--info);
            color: white;
        }
        
        .badge-accent {
            background: var(--accent);
            color: white;
        }
        
        .loading-details {
            font-size: 14px;
            color: var(--text-light);
            margin-top: 10px;
        }
        
        .contrib-type-filter {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }
        
        .type-filter-btn {
            padding: 6px 12px;
            background: white;
            border: 1px solid var(--border);
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .type-filter-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .detailed-stats {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .detailed-stats h4 {
            color: var(--primary);
            margin-bottom: 10px;
        }
        
        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px dashed #ddd;
        }
        
        .stat-row:last-child {
            border-bottom: none;
        }
        
        .stat-category {
            color: var(--text-light);
            font-size: 13px;
        }
        
        .stat-number {
            font-weight: 600;
            color: var(--text);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ЁЯУК ро╡ро┐роХрпНроХро┐роорпАроЯро┐ропро╛ рокроЩрпНроХро│ро┐рокрпНрокрпБ рокроХрпБрокрпНрокро╛ропрпНро╡рпБ роХро░рпБро╡ро┐ - роорпБро┤рпБроорпИропро╛рой рокродро┐рокрпНрокрпБ</h1>
            <p class="subtitle">роОро▓рпНро▓ро╛ роЪро┐ро▒рпБ родро┐ро░рпБродрпНродроЩрпНроХро│рпИропрпБроорпН роЙро│рпНро│роЯроХрпНроХро┐роп роорпБро┤рпБроорпИропро╛рой рокроЩрпНроХро│ро┐рокрпНрокрпБ рокрпБро│рпНро│ро┐ро╡ро┐ро╡ро░роЩрпНроХро│рпН</p>
            <div class="participant-count">
                <span id="participantCount">0</span> рокроЩрпНроХро│ро┐рокрпНрокро╛ро│ро░рпНроХро│рпН
            </div>
        </header>
        
        <div class="controls-container">
            <div class="input-sections">
                <!-- рокроЩрпНроХро│ро┐рокрпНрокро╛ро│ро░рпНроХро│рпН роЙро│рпНро│рпАроЯрпНроЯрпБрокрпН рокроХрпБродро┐ -->
                <div class="input-section">
                    <div class="section-title">
                        <i>ЁЯСе</i>
                        <span>рокроЩрпНроХро│ро┐рокрпНрокро╛ро│ро░рпНроХро│рпИроЪрпН роЪрпЗро░рпНроХрпНроХро╡рпБроорпН</span>
                    </div>
                    
                    <div class="user-input-methods">
                        <div class="method-tab active" onclick="switchInputMethod('manual')">тЬНя╕П роХрпИроорпБро▒рпИропро╛роХ</div>
                        <div class="method-tab" onclick="switchInputMethod('paste')">ЁЯУЛ роироХро▓рпЖроЯрпБ/роТроЯрпНроЯрпБ</div>
                        <div class="method-tab" onclick="switchInputMethod('extract')">ЁЯМР рокроХрпНроХродрпНродро┐ро▓ро┐ро░рпБроирпНродрпБ</div>
                    </div>
                    
                    <!-- роХрпИроорпБро▒рпИ роЙро│рпНро│рпАроЯрпНроЯрпБ роорпБро▒рпИ -->
                    <div id="manual-method" class="input-method-content active">
                        <div class="input-group">
                            <label for="usernameInput">рокропройро░рпН рокрпЖропро░рпИ роЙро│рпНро│ро┐роЯро╡рпБроорпН:</label>
                            <div style="display: flex; gap: 10px;">
                                <input type="text" id="usernameInput" 
                                       placeholder="роО.роХро╛: Neyakkoo">
                                <button type="button" onclick="addManualParticipant()" 
                                        style="min-width: auto; padding: 10px 20px;">
                                    тЮХ роЪрпЗро░рпНроХрпНроХ
                                </button>
                            </div>
                        </div>
                        
                        <div class="preset-buttons">
                            <small>ро╡ро┐ро░рпИро╡рпБ роЪрпЗро░рпНроХрпНроХ:</small>
                            <button class="preset-btn" onclick="addPresetUser('Neyakkoo')">Neyakkoo</button>
                            <button class="preset-btn" onclick="addPresetUser('Subisena')">Subisena</button>
                            <button class="preset-btn" onclick="addPresetUser('роирпЗропроХрпНроХрпЛ')">роирпЗропроХрпНроХрпЛ</button>
                            <button class="preset-btn" onclick="clearParticipants()">ЁЯз╣ роЕройрпИродрпНродрпБроорпН роирпАроХрпНроХрпБ</button>
                        </div>
                    </div>
                    
                    <!-- роироХро▓рпЖроЯрпБ/роТроЯрпНроЯрпБ роорпБро▒рпИ -->
                    <div id="paste-method" class="input-method-content">
                        <div class="input-group">
                            <label for="participantsTextarea">рокроЩрпНроХро│ро┐рокрпНрокро╛ро│ро░рпНроХро│ро┐ройрпН рокроЯрпНроЯро┐ропро▓рпИ роТроЯрпНроЯро╡рпБроорпН:</label>
                            <textarea id="participantsTextarea" 
                                      placeholder="роТро╡рпНро╡рпКро░рпБ ро╡ро░ро┐ропро┐ро▓рпБроорпН роТро░рпБ рокропройро░рпН рокрпЖропро░рпН:
Neyakkoo
Subisena
Mallika Vijayakumar
роирпЗропроХрпНроХрпЛ"></textarea>
                        </div>
                        
                        <button type="button" onclick="parsePastedParticipants()" 
                                class="btn-secondary" style="width: 100%;">
                            ЁЯУЛ роТроЯрпНроЯро┐роп рокроЯрпНроЯро┐ропро▓рпИроЪрпН роЪрпЗро░рпНроХрпНроХ
                        </button>
                    </div>
                    
                    <!-- рокроХрпНроХродрпНродро┐ро▓ро┐ро░рпБроирпНродрпБ рокро┐ро░ро┐родрпНродрпЖроЯрпБроХрпНроХрпБроорпН роорпБро▒рпИ -->
                    <div id="extract-method" class="input-method-content">
                        <div class="input-group">
                            <label for="pageUrl">ро╡ро┐роХрпНроХро┐ рокроХрпНроХроорпН URL:</label>
                            <input type="text" id="pageUrl" 
                                   value="https://ta.wikisource.org/wiki/ро╡ро┐роХрпНроХро┐роорпВро▓роорпН:ро╡ро┐роХрпНроХро┐рокрпНрокрпАроЯро┐ропро╛25_рокро┐ро▒роирпНродроиро╛ро│рпН_ро╡ро┐ро┤ро╛_роиро╛ро│рпН_1"
                                   placeholder="https://ta.wikipedia.org/wiki/рокроХрпНроХроорпН_рокрпЖропро░рпН">
                        </div>
                        
                        <div class="auto-extract-options">
                            <div class="option-btn active" onclick="setExtractionMode('wikitext')">
                                ро╡ро┐роХрпНроХро┐ роЙро░рпИ (роХрпИропрпКрокрпНрокроЩрпНроХро│рпН)
                            </div>
                            <div class="option-btn" onclick="setExtractionMode('participants')">
                                рокроЩрпНроХро│ро┐рокрпНрокро╛ро│ро░рпН рокроЯрпНроЯро┐ропро▓рпН
                            </div>
                        </div>
                        
                        <button type="button" onclick="extractFromPage()" 
                                class="btn-secondary" style="width: 100%; margin-top: 15px;">
                            ЁЯМР рокроХрпНроХродрпНродро┐ро▓ро┐ро░рпБроирпНродрпБ рокро┐ро░ро┐родрпНродрпЖроЯрпБ
                        </button>
                    </div>
                    
                    <!-- родро▒рпНрокрпЛродрпИроп рокроЩрпНроХро│ро┐рокрпНрокро╛ро│ро░рпНроХро│рпН -->
                    <div class="input-group">
                        <label>родро▒рпНрокрпЛродрпИроп рокроЩрпНроХро│ро┐рокрпНрокро╛ро│ро░рпНроХро│рпН:</label>
                        <div class="participant-list" id="participantsList">
                            <!-- рокроЩрпНроХро│ро┐рокрпНрокро╛ро│ро░рпНроХро│рпН роЗроЩрпНроХрпЗ роХро╛роЯрпНроЯрокрпНрокроЯрпБроорпН -->
                        </div>
                    </div>
                    
                    <div class="stats-preview">
                        <h4>родро▒рпНрокрпЛродрпИроп рокрпБро│рпНро│ро┐ро╡ро┐ро╡ро░роорпН:</h4>
                        <div class="stats-grid">
                            <div class="stat-preview">
                                <div class="value" id="previewTotal">0</div>
                                <div class="label">рокроЩрпНроХро│ро┐рокрпНрокро╛ро│ро░рпНроХро│рпН</div>
                            </div>
                            <div class="stat-preview">
                                <div class="value" id="previewValid">0</div>
                                <div class="label">роЪрпЖро▓рпНро▓рпБрокроЯро┐ропро╛ройро╡рпИ</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- рокроХрпБрокрпНрокро╛ропрпНро╡рпБ роЕроорпИрокрпНрокрпБроХро│рпН рокроХрпБродро┐ -->
                <div class="input-section">
                    <div class="section-title">
                        <i>тЪЩя╕П</i>
                        <span>рокроХрпБрокрпНрокро╛ропрпНро╡рпБ роЕроорпИрокрпНрокрпБроХро│рпН</span>
                    </div>
                    
                    <div class="input-group">
                        <label>роХро╛ро▓ роЕро│ро╡рпБ:</label>
                        <div class="date-inputs">
                            <div>
                                <label for="startDate" style="font-size: 13px;">родрпКроЯроХрпНроХроорпН:</label>
                                <input type="date" id="startDate" value="2026-01-31">
                            </div>
                            <div>
                                <label for="endDate" style="font-size: 13px;">роорпБроЯро┐ро╡рпБ:</label>
                                <input type="date" id="endDate" value="2026-02-07">
                            </div>
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <label for="projectsSelect">роЪрпЗро░рпНроХрпНроХ ро╡рпЗрогрпНроЯро┐роп родро┐роЯрпНроЯроЩрпНроХро│рпН:</label>
                        <select id="projectsSelect" multiple size="6">
                            <option value="ta.wikipedia.org" selected>родрооро┐ро┤рпН ро╡ро┐роХрпНроХро┐рокрпНрокрпАроЯро┐ропро╛</option>
                            <option value="ta.wikisource.org" selected>родрооро┐ро┤рпН ро╡ро┐роХрпНроХро┐роорпВро▓роорпН</option>
                            <option value="ta.wiktionary.org" selected>родрооро┐ро┤рпН ро╡ро┐роХрпНроХро┐ропройро░ро┐</option>
                            <option value="ta.wikibooks.org">родрооро┐ро┤рпН ро╡ро┐роХрпНроХро┐роирпВро▓рпНроХро│рпН</option>
                            <option value="commons.wikimedia.org" selected>ро╡ро┐роХрпНроХро┐роорпАроЯро┐ропро╛ рокрпКродрпБро╡роХроорпН</option>
                            <option value="wikidata.org" selected>ро╡ро┐роХрпНроХро┐родро░ро╡рпБ</option>
                            <option value="meta.wikimedia.org">роорпЗроЯрпНроЯро╛-ро╡ро┐роХрпНроХро┐</option>
                        </select>
                        <p class="example-text">
                            Ctrl (Windows) роЕро▓рпНро▓родрпБ Cmd (Mac) ро╡рпИродрпНродрпБроХрпНроХрпКрогрпНроЯрпБ рокро▓ро╡ро▒рпНро▒рпИродрпН родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХро╡рпБроорпН
                        </p>
                    </div>
                    
                    <div class="input-group">
                        <label for="contributionLimit">роТро░рпБ рокропройро░рпБроХрпНроХрпБ роЕродро┐роХрокроЯрпНроЪ рокроЩрпНроХро│ро┐рокрпНрокрпБроХро│рпН:</label>
                        <input type="number" id="contributionLimit" value="5000" min="100" max="10000">
                        <p class="example-text">
                            роЪро┐ро▒рпБ родро┐ро░рпБродрпНродроЩрпНроХро│рпИропрпБроорпН роЪрпЗро░рпНродрпНродрпБ рокрпЖро▒, роЙропро░рпН роОрогрпНрогро┐роХрпНроХрпИропрпИ роЕроорпИроХрпНроХро╡рпБроорпН
                        </p>
                    </div>
                    
                    <!-- роЙропро░рпНродро░ ро╡ро┐ро░рпБрокрпНрокроЩрпНроХро│рпН -->
                    <div class="advanced-options">
                        <h4>тЪб роЙропро░рпНродро░ рокроЩрпНроХро│ро┐рокрпНрокрпБ ро╡ро┐ро░рпБрокрпНрокроЩрпНроХро│рпН</h4>
                        <div class="checkbox-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="includeMinor" checked>
                                <span class="checkbox-text">
                                    роЪро┐ро▒рпБ родро┐ро░рпБродрпНродроЩрпНроХро│рпИроЪрпН роЪрпЗро░рпН (Minor edits)
                                    <span class="info-tooltip" title="рокроХрпНроХроорпН роорпБро┤рпБро╡родрпБроорпН рооро╛ро▒рпНро▒рооро┐ро▓рпНро▓ро╛род роЪро┐ро▒рпБ родро┐ро░рпБродрпНродроЩрпНроХро│рпН">?</span>
                                </span>
                            </label>
                            
                            <label class="checkbox-label">
                                <input type="checkbox" id="includeBot" checked>
                                <span class="checkbox-text">
                                    рокро╛роЯрпН родро┐ро░рпБродрпНродроЩрпНроХро│рпИроЪрпН роЪрпЗро░рпН (Bot edits)
                                    <span class="info-tooltip" title="родро╛ройро┐ропроЩрпНроХро┐ роиро┐ро░ро▓рпНроХро│ро╛ро▓рпН роЪрпЖропрпНропрокрпНрокроЯрпНроЯ родро┐ро░рпБродрпНродроЩрпНроХро│рпН">?</span>
                                </span>
                            </label>
                            
                            <label class="checkbox-label">
                                <input type="checkbox" id="includePatrolled" checked>
                                <span class="checkbox-text">
                                    роХрогрпНроХро╛рогро┐роХрпНроХрокрпНрокроЯрпНроЯ родро┐ро░рпБродрпНродроЩрпНроХро│рпИроЪрпН роЪрпЗро░рпН (Patrolled edits)
                                    <span class="info-tooltip" title="рокро░ро┐роЪрпЛродройрпИропро╛ро│ро░рпНроХро│ро╛ро▓рпН роЪро░ро┐рокро╛ро░рпНроХрпНроХрокрпНрокроЯрпНроЯ родро┐ро░рпБродрпНродроЩрпНроХро│рпН">?</span>
                                </span>
                            </label>
                            
                            <label class="checkbox-label">
                                <input type="checkbox" id="includeReverted" checked>
                                <span class="checkbox-text">
                                    роорпАро│роорпИроХрпНроХрокрпНрокроЯрпНроЯ родро┐ро░рпБродрпНродроЩрпНроХро│рпИроЪрпН роЪрпЗро░рпН (Reverted edits)
                                    <span class="info-tooltip" title="рокро┐ройрпНройро░рпН роорпАро│роорпИроХрпНроХрокрпНрокроЯрпНроЯ родро┐ро░рпБродрпНродроЩрпНроХро│рпН">?</span>
                                </span>
                            </label>
                            
                            <label class="checkbox-label">
                                <input type="checkbox" id="includeAllNamespaces" checked>
                                <span class="checkbox-text">
                                    роЕройрпИродрпНродрпБ рокрпЖропро░рпНро╡рпЖро│ро┐роХро│рпИропрпБроорпН роЪрпЗро░рпН
                                    <span class="info-tooltip" title="роХроЯрпНроЯрпБро░рпИроХро│рпН, рокрпЗроЪрпНроЪрпБ рокроХрпНроХроЩрпНроХро│рпН, рокропройро░рпН рокроХрпНроХроЩрпНроХро│рпН, ро╡ро╛ро░рпНрокрпНрокрпБро░рпБроХрпНроХро│рпН рокрпЛройрпНро▒ро╡рпИ">?</span>
                                </span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="help-box">
                        <h3>ЁЯТб Neyakkoo-ро╡ро┐ройрпН роЙрогрпНроорпИропро╛рой рокроЩрпНроХро│ро┐рокрпНрокрпБроХро│рпН</h3>
                        <div class="help-content">
                            <div class="help-item">
                                <h4>API роороЯрпНроЯрпБрокрпНрокроЯрпБродрпНродро▓рпН</h4>
                                <ul>
                                    <li>MediaWiki API 5000 родро┐ро░рпБродрпНродроЩрпНроХро│рпН ро╡ро░рпИ роороЯрпНроЯрпБроорпЗ родро░рпБроорпН</li>
                                    <li>роЪро┐ро▒рпБ родро┐ро░рпБродрпНродроЩрпНроХро│рпН родро╛ройро╛роХ рооро▒рпИроХрпНроХрокрпНрокроЯрпБроорпН</li>
                                    <li>роЗроирпНродроХрпН роХро░рпБро╡ро┐ роЕройрпИродрпНродрпИропрпБроорпН рокрпЖро▒ роорпБропро▒рпНроЪро┐роХрпНроХрпБроорпН</li>
                                </ul>
                            </div>
                            <div class="help-item">
                                <h4>роорпБро┤рпБроорпИропро╛рой роОрогрпНрогро┐роХрпНроХрпИроХрпНроХрпБ</h4>
                                <ul>
                                    <li>рокроЩрпНроХро│ро┐рокрпНрокрпБ ро╡ро░роорпНрокрпИ 5000 роЖроХ роЕроорпИроХрпНроХро╡рпБроорпН</li>
                                    <li>"роЪро┐ро▒рпБ родро┐ро░рпБродрпНродроЩрпНроХро│рпИроЪрпН роЪрпЗро░рпН" родрпЗро░рпНро╡рпБ роЪрпЖропрпНропро╡рпБроорпН</li>
                                    <li>рокро▓ родро┐роЯрпНроЯроЩрпНроХро│рпИроЪрпН роЪрпЗро░рпНродрпНродрпБ роЪро░ро┐рокро╛ро░рпНроХрпНроХро╡рпБроорпН</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="action-buttons">
                <button id="analyzeBtn" class="btn-primary">
                    <span>ЁЯФН роорпБро┤рпБроорпИропро╛рой рокроХрпБрокрпНрокро╛ропрпНро╡рпБ</span>
                </button>
                <button id="testNeyakkooBtn" class="btn-accent" onclick="testNeyakkooContributions()">
                    <span>ЁЯзк Neyakkoo роЪрпЛродройрпИ</span>
                </button>
                <button id="saveConfigBtn" class="btn-secondary" onclick="saveConfiguration()">
                    <span>ЁЯТ╛ роЕроорпИрокрпНрокрпБроХро│рпИроЪрпН роЪрпЗрооро┐</span>
                </button>
                <button id="clearAllBtn" class="btn-warning" onclick="clearAllData()">
                    <span>ЁЯз╣ роЕройрпИродрпНродрпБроорпН роирпАроХрпНроХрпБ</span>
                </button>
            </div>
        </div>
        
        <div id="statusMessage" class="status-message"></div>
        
        <div id="loading">
            <div class="spinner"></div>
            <p id="progressText">рокроЩрпНроХро│ро┐рокрпНрокрпБроХро│рпН рокрпЖро▒рокрпНрокроЯрпБроХро┐ройрпНро▒рой...</p>
            <div style="margin-top: 20px;">
                <div style="width: 100%; background: #e0e0e0; border-radius: 10px; height: 10px;">
                    <div id="progressBar" style="width: 0%; height: 100%; background: linear-gradient(90deg, var(--primary) 0%, var(--primary-light) 100%); border-radius: 10px; transition: width 0.3s;"></div>
                </div>
            </div>
            <div class="loading-details" id="loadingDetails"></div>
        </div>
        
        <div id="results">
            <!-- роорпБроЯро┐ро╡рпБроХро│рпН роЗроЩрпНроХрпЗ роХро╛роЯрпНроЯрокрпНрокроЯрпБроорпН -->
            <div style="text-align: center; padding: 60px 20px; color: var(--text-light);">
                <div style="font-size: 64px; margin-bottom: 20px;">ЁЯУК</div>
                <h2 style="color: var(--primary); margin-bottom: 15px;">роорпБро┤рпБроорпИропро╛рой рокроЩрпНроХро│ро┐рокрпНрокрпБ рокроХрпБрокрпНрокро╛ропрпНро╡рпБ</h2>
                <p>рокроЩрпНроХро│ро┐рокрпНрокро╛ро│ро░рпНроХро│рпИроЪрпН роЪрпЗро░рпНроХрпНроХро╡рпБроорпН, "роорпБро┤рпБроорпИропро╛рой рокроХрпБрокрпНрокро╛ропрпНро╡рпБ" рокрпКродрпНродро╛ройрпИроХрпН роХро┐ро│ро┐роХрпН роЪрпЖропрпНропро╡рпБроорпН</p>
                <p style="font-size: 14px; margin-top: 10px; color: var(--warning);">
                    тЪая╕П <strong>роХрпБро▒ро┐рокрпНрокрпБ:</strong> API роороЯрпНроЯрпБрокрпНрокроЯрпБродрпНродро▓рпН роХро╛ро░рогрооро╛роХ роЪро┐ро▒рпБ родро┐ро░рпБродрпНродроЩрпНроХро│рпН родро╛ройро╛роХ рооро▒рпИроХрпНроХрокрпНрокроЯро▓ро╛роорпН
                </p>
            </div>
        </div>
    </div>

    <script>
        // рокроЩрпНроХро│ро┐рокрпНрокро╛ро│ро░рпН роорпЗро▓ро╛рогрпНроорпИ
        let participants = new Set();
        let extractionMode = 'wikitext';
        
        // DOM роХрпВро▒рпБроХро│рпН
        const participantCountEl = document.getElementById('participantCount');
        const participantsListEl = document.getElementById('participantsList');
        const usernameInput = document.getElementById('usernameInput');
        const participantsTextarea = document.getElementById('participantsTextarea');
        const pageUrlInput = document.getElementById('pageUrl');
        const startDateInput = document.getElementById('startDate');
        const endDateInput = document.getElementById('endDate');
        const projectsSelect = document.getElementById('projectsSelect');
        const contributionLimitInput = document.getElementById('contributionLimit');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const loadingDiv = document.getElementById('loading');
        const progressText = document.getElementById('progressText');
        const progressBar = document.getElementById('progressBar');
        const statusMessage = document.getElementById('statusMessage');
        const resultsDiv = document.getElementById('results');
        const loadingDetails = document.getElementById('loadingDetails');
        
        // роЙропро░рпНродро░ ро╡ро┐ро░рпБрокрпНрокроЩрпНроХро│рпН
        const includeMinor = document.getElementById('includeMinor');
        const includeBot = document.getElementById('includeBot');
        const includePatrolled = document.getElementById('includePatrolled');
        const includeReverted = document.getElementById('includeReverted');
        const includeAllNamespaces = document.getElementById('includeAllNamespaces');
        
        // роорпБройрпНройрпЛроЯрпНроЯ рокрпБро│рпНро│ро┐ро╡ро┐ро╡ро░роЩрпНроХро│рпН
        const previewTotal = document.getElementById('previewTotal');
        const previewValid = document.getElementById('previewValid');
        
        // родрпКроЯроХрпНроХродрпНродро┐ро▓рпН рокроЩрпНроХро│ро┐рокрпНрокро╛ро│ро░рпНроХро│рпИ роПро▒рпНро▒рпБ
        document.addEventListener('DOMContentLoaded', function() {
            loadParticipantsFromStorage();
            updateParticipantDisplay();
            
            // Neyakkoo-ро╡рпИ рооро╛родро┐ро░ро┐ропро╛роХроЪрпН роЪрпЗро░рпНроХрпНроХ
            if (participants.size === 0) {
                addPresetUser('Neyakkoo');
            }
            
            // родрпЗродро┐роХро│рпИ роЕроорпИроХрпНроХро╡рпБроорпН
            if (!startDateInput.value) startDateInput.value = '2026-01-31';
            if (!endDateInput.value) endDateInput.value = '2026-02-07';
            
            // Enter ро╡ро┐роЪрпИропрпИроХрпН роХрпЗроЯрпНроХ
            usernameInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    addManualParticipant();
                }
            });
        });
        
        // Neyakkoo-ро╡ро┐ройрпН рокроЩрпНроХро│ро┐рокрпНрокрпБроХро│рпИ роЪрпЛродро┐роХрпНроХ
        async function testNeyakkooContributions() {
            participants.clear();
            participants.add('Neyakkoo');
            updateParticipantDisplay();
            
            showStatus('Neyakkoo-ро╡ро┐ройрпН роорпБро┤рпБроорпИропро╛рой рокроЩрпНроХро│ро┐рокрпНрокрпБроХро│рпИрокрпН рокрпЖро▒рпБроХро┐ро▒родрпБ...', 'info');
            
            // родрпЗродро┐роХро│рпИ роиро┐роХро┤рпНро╡рпБ роХро╛ро▓родрпНродро┐ро▒рпНроХрпБ роЕроорпИроХрпНроХро╡рпБроорпН
            startDateInput.value = '2026-01-31';
            endDateInput.value = '2026-02-07';
            
            // роЕродро┐роХрокроЯрпНроЪ ро╡ро░роорпНрокрпИ роЕроорпИроХрпНроХро╡рпБроорпН
            contributionLimitInput.value = '5000';
            
            // роЕройрпИродрпНродрпБ ро╡ро┐ро░рпБрокрпНрокроЩрпНроХро│рпИропрпБроорпН роЗропроХрпНроХро╡рпБроорпН
            includeMinor.checked = true;
            includeBot.checked = true;
            includePatrolled.checked = true;
            includeReverted.checked = true;
            includeAllNamespaces.checked = true;
            
            // роЕройрпИродрпНродрпБ родро┐роЯрпНроЯроЩрпНроХро│рпИропрпБроорпН родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХро╡рпБроорпН
            Array.from(projectsSelect.options).forEach(option => {
                option.selected = true;
            });
            
            // 1 ро╡ро┐ройро╛роЯро┐ роХро╛родрпНродро┐ро░рпБроирпНродрпБ рокроХрпБрокрпНрокро╛ропрпНро╡рпИродрпН родрпКроЯроЩрпНроХро╡рпБроорпН
            setTimeout(() => {
                analyzeBtn.click();
            }, 1000);
        }
        
        // роХро░рпБро╡ро┐ роЪрпЖропро▓рпНрокро╛роЯрпБроХро│рпН (роорпБроирпНродрпИроп роХрпБро▒ро┐ропрпАроЯрпНроЯро┐ро▓ро┐ро░рпБроирпНродрпБ)
        function switchInputMethod(method) {
            document.querySelectorAll('.method-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.input-method-content').forEach(content => {
                content.classList.remove('active');
            });
            
            document.querySelector(`.method-tab[onclick*="${method}"]`).classList.add('active');
            document.getElementById(`${method}-method`).classList.add('active');
        }
        
        function setExtractionMode(mode) {
            extractionMode = mode;
            document.querySelectorAll('.option-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        }
        
        function addManualParticipant() {
            const username = usernameInput.value.trim();
            if (!username) {
                showStatus('рокропройро░рпН рокрпЖропро░рпИ роЙро│рпНро│ро┐роЯро╡рпБроорпН', 'warning');
                usernameInput.focus();
                return;
            }
            
            if (addParticipant(username)) {
                usernameInput.value = '';
                usernameInput.focus();
                showStatus(`${username} роЪрпЗро░рпНроХрпНроХрокрпНрокроЯрпНроЯродрпБ`, 'success');
            }
        }
        
        function addPresetUser(username) {
            if (addParticipant(username)) {
                showStatus(`${username} роЪрпЗро░рпНроХрпНроХрокрпНрокроЯрпНроЯродрпБ`, 'success');
            }
        }
        
        function addParticipant(username) {
            const cleanUsername = cleanUsernameString(username);
            
            if (!cleanUsername || cleanUsername.length < 2) {
                showStatus('роЪрпЖро▓рпНро▓рпБрокроЯро┐ропро╛роХро╛род рокропройро░рпН рокрпЖропро░рпН', 'error');
                return false;
            }
            
            if (participants.has(cleanUsername)) {
                showStatus(`${cleanUsername} роПро▒рпНроХройро╡рпЗ роЙро│рпНро│родрпБ`, 'warning');
                return false;
            }
            
            participants.add(cleanUsername);
            updateParticipantDisplay();
            saveParticipantsToStorage();
            return true;
        }
        
        function cleanUsernameString(username) {
            let clean = username
                .replace(/^--\s*/, '')
                .replace(/\([^)]*\)$/, '')
                .replace(/\[\[[^\]]*\|/, '')
                .replace(/\[\[|\]\]/g, '')
                .replace(/рокропройро░рпН:/i, '')
                .replace(/User:/i, '')
                .replace(/\d{1,2}:\d{2}.*$/, '')
                .replace(/\(UTC\).*$/i, '')
                .trim();
            
            if (/^\d+$/.test(clean)) return '';
            return clean;
        }
        
        function parsePastedParticipants() {
            const text = participantsTextarea.value.trim();
            if (!text) {
                showStatus('роЙро░рпИропрпИ роТроЯрпНроЯро╡рпБроорпН', 'warning');
                return;
            }
            
            const lines = text.split('\n');
            let addedCount = 0;
            
            lines.forEach(line => {
                const username = line.trim();
                if (!username) return;
                
                const cleanUsername = cleanUsernameString(username);
                if (!cleanUsername) return;
                
                if (!participants.has(cleanUsername)) {
                    participants.add(cleanUsername);
                    addedCount++;
                }
            });
            
            updateParticipantDisplay();
            saveParticipantsToStorage();
            
            if (addedCount > 0) {
                showStatus(`${addedCount} рокрпБродро┐роп рокроЩрпНроХро│ро┐рокрпНрокро╛ро│ро░рпНроХро│рпН роЪрпЗро░рпНроХрпНроХрокрпНрокроЯрпНроЯройро░рпН`, 'success');
            } else {
                showStatus('рокрпБродро┐роп рокроЩрпНроХро│ро┐рокрпНрокро╛ро│ро░рпНроХро│рпН роОродрпБро╡рпБроорпН роЪрпЗро░рпНроХрпНроХрокрпНрокроЯро╡ро┐ро▓рпНро▓рпИ', 'warning');
            }
            
            participantsTextarea.value = '';
        }
        
        async function extractFromPage() {
            const url = pageUrlInput.value.trim();
            if (!url) {
                showStatus('URL роР роЙро│рпНро│ро┐роЯро╡рпБроорпН', 'warning');
                return;
            }
            
            try {
                showLoading(true, 'рокроХрпНроХроорпН рокрпЖро▒рокрпНрокроЯрпБроХро┐ро▒родрпБ...');
                
                const proxyUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(url)}`;
                const response = await fetch(proxyUrl);
                
                if (!response.ok) {
                    throw new Error(`рокроХрпНроХроорпН рокрпЖро▒ роорпБроЯро┐ропро╡ро┐ро▓рпНро▓рпИ: ${response.status}`);
                }
                
                const data = await response.json();
                const pageContent = data.contents;
                
                let extractedUsers = [];
                
                if (extractionMode === 'wikitext') {
                    extractedUsers = extractUsersFromWikitext(pageContent);
                } else {
                    extractedUsers = extractUsersFromParticipantsList(pageContent);
                }
                
                let addedCount = 0;
                
                extractedUsers.forEach(username => {
                    if (!participants.has(username)) {
                        participants.add(username);
                        addedCount++;
                    }
                });
                
                updateParticipantDisplay();
                saveParticipantsToStorage();
                showLoading(false);
                
                if (addedCount > 0) {
                    showStatus(`${addedCount} рокрпБродро┐роп рокроЩрпНроХро│ро┐рокрпНрокро╛ро│ро░рпНроХро│рпН рокро┐ро░ро┐родрпНродрпЖроЯрпБроХрпНроХрокрпНрокроЯрпНроЯройро░рпН`, 'success');
                } else {
                    showStatus('рокрпБродро┐роп рокропройро░рпНроХро│рпН роОродрпБро╡рпБроорпН роХро┐роЯрпИроХрпНроХро╡ро┐ро▓рпНро▓рпИ', 'warning');
                }
                
            } catch (error) {
                showLoading(false);
                showStatus(`рокро┐ро┤рпИ: ${error.message}`, 'error');
            }
        }
        
        function extractUsersFromWikitext(content) {
            const users = new Set();
            const patterns = [
                /--\s*([^\s\(]+)/g,
                /\[\[(?:рокропройро░рпН|User):([^|\]]+)/gi,
                /рокроЩрпНроХро│ро┐рокрпНрокро╛ро│ро░рпН[:\s]*([^\n<]+)/gi,
                /\*?\s*'''([^''']+)'''/g,
                /\/\/\s*([^\s]+)/g,
                /\|\s*рокроЩрпНроХро│ро┐рокрпНрокро╛ро│ро░рпН\s*=\s*([^\n|]+)/gi,
            ];
            
            patterns.forEach(pattern => {
                let match;
                while ((match = pattern.exec(content)) !== null) {
                    const rawUser = match[1].trim();
                    const cleanUser = cleanUsernameString(rawUser);
                    if (cleanUser && cleanUser.length > 1) {
                        users.add(cleanUser);
                    }
                }
            });
            
            return Array.from(users);
        }
        
        function extractUsersFromParticipantsList(content) {
            const users = new Set();
            const listPatterns = [
                /<li[^>]*>([^<]+)<\/li>/gi,
                /<td[^>]*>([^<]+)<\/td>/gi,
                /\*+\s*([^\n]+)/g,
                /\d+\.\s*([^\n]+)/g
            ];
            
            let textContent = content.replace(/<[^>]*>/g, '\n');
            
            listPatterns.forEach(pattern => {
                let match;
                while ((match = pattern.exec(textContent)) !== null) {
                    const rawUser = match[1].trim();
                    const cleanUser = cleanUsernameString(rawUser);
                    if (cleanUser && cleanUser.length > 1) {
                        users.add(cleanUser);
                    }
                }
            });
            
            return Array.from(users);
        }
        
        function updateParticipantDisplay() {
            participantCountEl.textContent = participants.size;
            previewTotal.textContent = participants.size;
            previewValid.textContent = participants.size;
            
            participantsListEl.innerHTML = '';
            
            Array.from(participants).sort().forEach(username => {
                const div = document.createElement('div');
                div.className = 'participant-item';
                div.innerHTML = `
                    <span>${username}</span>
                    <button class="remove-participant" onclick="removeParticipant('${username}')">├Ч</button>
                `;
                participantsListEl.appendChild(div);
            });
            
            analyzeBtn.disabled = participants.size === 0;
        }
        
        function removeParticipant(username) {
            participants.delete(username);
            updateParticipantDisplay();
            saveParticipantsToStorage();
            showStatus(`${username} роирпАроХрпНроХрокрпНрокроЯрпНроЯродрпБ`, 'success');
        }
        
        function clearParticipants() {
            if (participants.size === 0) return;
            
            if (confirm(`роЕройрпИродрпНродрпБ ${participants.size} рокроЩрпНроХро│ро┐рокрпНрокро╛ро│ро░рпНроХро│рпИропрпБроорпН роирпАроХрпНроХ ро╡ро┐ро░рпБроорпНрокрпБроХро┐ро▒рпАро░рпНроХро│ро╛?`)) {
                participants.clear();
                updateParticipantDisplay();
                saveParticipantsToStorage();
                showStatus('роЕройрпИродрпНродрпБ рокроЩрпНроХро│ро┐рокрпНрокро╛ро│ро░рпНроХро│рпБроорпН роирпАроХрпНроХрокрпНрокроЯрпНроЯройро░рпН', 'success');
            }
        }
        
        function loadParticipantsFromStorage() {
            try {
                const saved = localStorage.getItem('wikiParticipants');
                if (saved) {
                    const savedParticipants = JSON.parse(saved);
                    participants = new Set(savedParticipants);
                }
            } catch (error) {
                console.error('роЪрпЗрооро┐рокрпНрокроХродрпНродро┐ро▓ро┐ро░рпБроирпНродрпБ роПро▒рпНро▒рпБро╡родро┐ро▓рпН рокро┐ро┤рпИ:', error);
            }
        }
        
        function saveParticipantsToStorage() {
            try {
                localStorage.setItem('wikiParticipants', JSON.stringify(Array.from(participants)));
            } catch (error) {
                console.error('роЪрпЗрооро┐рокрпНрокроХродрпНродро┐ро▓рпН роЪрпЗрооро┐рокрпНрокродро┐ро▓рпН рокро┐ро┤рпИ:', error);
            }
        }
        
        function saveConfiguration() {
            try {
                const config = {
                    participants: Array.from(participants),
                    startDate: startDateInput.value,
                    endDate: endDateInput.value,
                    selectedProjects: Array.from(projectsSelect.selectedOptions).map(opt => opt.value),
                    contributionLimit: contributionLimitInput.value,
                    pageUrl: pageUrlInput.value,
                    includeMinor: includeMinor.checked,
                    includeBot: includeBot.checked,
                    includePatrolled: includePatrolled.checked,
                    includeReverted: includeReverted.checked,
                    includeAllNamespaces: includeAllNamespaces.checked
                };
                
                localStorage.setItem('wikiAnalyzerConfig', JSON.stringify(config));
                showStatus('роЕроорпИрокрпНрокрпБроХро│рпН роЪрпЗрооро┐роХрпНроХрокрпНрокроЯрпНроЯрой', 'success');
            } catch (error) {
                showStatus(`роЪрпЗрооро┐рокрпНрокрпБ рокро┐ро┤рпИ: ${error.message}`, 'error');
            }
        }
        
        function loadConfiguration() {
            try {
                const saved = localStorage.getItem('wikiAnalyzerConfig');
                if (!saved) {
                    showStatus('роЪрпЗрооро┐роХрпНроХрокрпНрокроЯрпНроЯ роЕроорпИрокрпНрокрпБроХро│рпН роОродрпБро╡рпБроорпН роЗро▓рпНро▓рпИ', 'warning');
                    return;
                }
                
                const config = JSON.parse(saved);
                
                participants = new Set(config.participants || []);
                updateParticipantDisplay();
                
                if (config.startDate) startDateInput.value = config.startDate;
                if (config.endDate) endDateInput.value = config.endDate;
                if (config.contributionLimit) contributionLimitInput.value = config.contributionLimit;
                if (config.pageUrl) pageUrlInput.value = config.pageUrl;
                
                Array.from(projectsSelect.options).forEach(option => {
                    option.selected = config.selectedProjects?.includes(option.value) || false;
                });
                
                if (config.includeMinor !== undefined) includeMinor.checked = config.includeMinor;
                if (config.includeBot !== undefined) includeBot.checked = config.includeBot;
                if (config.includePatrolled !== undefined) includePatrolled.checked = config.includePatrolled;
                if (config.includeReverted !== undefined) includeReverted.checked = config.includeReverted;
                if (config.includeAllNamespaces !== undefined) includeAllNamespaces.checked = config.includeAllNamespaces;
                
                showStatus('роЕроорпИрокрпНрокрпБроХро│рпН роПро▒рпНро▒рокрпНрокроЯрпНроЯрой', 'success');
            } catch (error) {
                showStatus(`роПро▒рпНро▒рпБроорпН рокро┐ро┤рпИ: ${error.message}`, 'error');
            }
        }
        
        function clearAllData() {
            if (confirm('роЕройрпИродрпНродрпБ рокроЩрпНроХро│ро┐рокрпНрокро╛ро│ро░рпНроХро│рпН, роЕроорпИрокрпНрокрпБроХро│рпН рооро▒рпНро▒рпБроорпН роорпБроЯро┐ро╡рпБроХро│рпИропрпБроорпН роирпАроХрпНроХ ро╡ро┐ро░рпБроорпНрокрпБроХро┐ро▒рпАро░рпНроХро│ро╛?')) {
                participants.clear();
                updateParticipantDisplay();
                
                usernameInput.value = '';
                participantsTextarea.value = '';
                pageUrlInput.value = 'https://ta.wikisource.org/wiki/ро╡ро┐роХрпНроХро┐роорпВро▓роорпН:ро╡ро┐роХрпНроХро┐рокрпНрокрпАроЯро┐ропро╛25_рокро┐ро▒роирпНродроиро╛ро│рпН_ро╡ро┐ро┤ро╛_роиро╛ро│рпН_1';
                startDateInput.value = '2026-01-31';
                endDateInput.value = '2026-02-07';
                contributionLimitInput.value = '5000';
                
                Array.from(projectsSelect.options).forEach(option => {
                    option.selected = ['ta.wikipedia.org', 'ta.wikisource.org', 'ta.wiktionary.org', 'commons.wikimedia.org', 'wikidata.org']
                        .includes(option.value);
                });
                
                includeMinor.checked = true;
                includeBot.checked = true;
                includePatrolled.checked = true;
                includeReverted.checked = true;
                includeAllNamespaces.checked = true;
                
                localStorage.removeItem('wikiParticipants');
                localStorage.removeItem('wikiAnalyzerConfig');
                
                resultsDiv.innerHTML = `
                    <div style="text-align: center; padding: 60px 20px; color: var(--text-light);">
                        <div style="font-size: 64px; margin-bottom: 20px;">ЁЯФД</div>
                        <h2 style="color: var(--primary); margin-bottom: 15px;">родро░ро╡рпБроХро│рпН роЕро┤ро┐роХрпНроХрокрпНрокроЯрпНроЯрой</h2>
                        <p>рокрпБродро┐роп рокроЩрпНроХро│ро┐рокрпНрокро╛ро│ро░рпНроХро│рпИроЪрпН роЪрпЗро░рпНроХрпНроХро╡рпБроорпН, рокро┐ройрпНройро░рпН "роорпБро┤рпБроорпИропро╛рой рокроХрпБрокрпНрокро╛ропрпНро╡рпБ" рокрпКродрпНродро╛ройрпИроХрпН роХро┐ро│ро┐роХрпН роЪрпЖропрпНропро╡рпБроорпН</p>
                    </div>`;
                
                showStatus('роЕройрпИродрпНродрпБ родро░ро╡рпБроХро│рпБроорпН роЕро┤ро┐роХрпНроХрокрпНрокроЯрпНроЯрой', 'success');
            }
        }
        
        function showStatus(message, type = 'info') {
            statusMessage.textContent = message;
            statusMessage.className = `status-message status-${type}`;
            statusMessage.style.display = 'block';
            
            if (type !== 'error') {
                setTimeout(() => {
                    statusMessage.style.display = 'none';
                }, 5000);
            }
        }
        
        function showLoading(show, message = '') {
            loadingDiv.style.display = show ? 'block' : 'none';
            if (message) {
                progressText.textContent = message;
            }
        }
        
        function updateProgress(percentage, message, details = '') {
            progressBar.style.width = `${percentage}%`;
            if (message) {
                progressText.textContent = message;
            }
            if (details) {
                loadingDetails.textContent = details;
            }
        }
        
        // рокроХрпБрокрпНрокро╛ропрпНро╡рпИродрпН родрпКроЯроЩрпНроХрпБроХ
        analyzeBtn.addEventListener('click', async function() {
            if (participants.size === 0) {
                showStatus('роорпБродро▓ро┐ро▓рпН рокроЩрпНроХро│ро┐рокрпНрокро╛ро│ро░рпНроХро│рпИроЪрпН роЪрпЗро░рпНроХрпНроХро╡рпБроорпН', 'warning');
                return;
            }
            
            const startDate = startDateInput.value;
            const endDate = endDateInput.value;
            
            if (!startDate || !endDate) {
                showStatus('родрпЗродро┐ ро╡ро░роорпНрокрпИродрпН родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХро╡рпБроорпН', 'warning');
                return;
            }
            
            try {
                analyzeBtn.disabled = true;
                analyzeBtn.innerHTML = '<span>тП│ роорпБро┤рпБроорпИропро╛рой рокроХрпБрокрпНрокро╛ропрпНро╡рпБ...</span>';
                
                const analyzer = new CompleteContributionsAnalyzer();
                const report = await analyzer.analyzeEvent(
                    Array.from(participants),
                    startDate,
                    endDate
                );
                
                analyzer.displayReport(report, 'results');
                
                analyzeBtn.disabled = false;
                analyzeBtn.innerHTML = '<span>ЁЯФН роорпБро┤рпБроорпИропро╛рой рокроХрпБрокрпНрокро╛ропрпНро╡рпБ</span>';
                
            } catch (error) {
                console.error('рокроХрпБрокрпНрокро╛ропрпНро╡рпБ рокро┐ро┤рпИ:', error);
                showStatus(`рокроХрпБрокрпНрокро╛ропрпНро╡рпБ рокро┐ро┤рпИ: ${error.message}`, 'error');
                analyzeBtn.disabled = false;
                analyzeBtn.innerHTML = '<span>ЁЯФН роорпБро┤рпБроорпИропро╛рой рокроХрпБрокрпНрокро╛ропрпНро╡рпБ</span>';
            }
        });

        // роорпБро┤рпБроорпИропро╛рой рокроЩрпНроХро│ро┐рокрпНрокрпБ рокроХрпБрокрпНрокро╛ропрпНро╡рпБ ро╡роХрпБрокрпНрокрпБ
        class CompleteContributionsAnalyzer {
            constructor() {
                this.contributions = new Map();
                this.projects = new Map();
                this.userStats = new Map();
                this.selectedProjects = Array.from(projectsSelect.selectedOptions)
                    .map(opt => ({
                        domain: opt.value,
                        name: opt.text
                    }));
                this.contributionLimit = parseInt(contributionLimitInput.value) || 5000;
            }

            async analyzeEvent(participants, startDate, endDate) {
                this.showLoading(true, 'родропро╛ро░ро╛роХро┐ро▒родрпБ...', '');
                
                const users = Array.from(participants);
                const totalUsers = users.length;
                let totalContributions = 0;
                let totalAPICalls = 0;
                
                for (let i = 0; i < users.length; i++) {
                    const username = users[i];
                    const progressPercent = Math.round(((i + 1) / totalUsers) * 100);
                    
                    this.updateProgress(progressPercent, 
                        `${username} - роорпБро┤рпБроорпИропро╛рой рокроЩрпНроХро│ро┐рокрпНрокрпБроХро│рпИрокрпН рокрпЖро▒рпБроХро┐ро▒родрпБ`,
                        `рокропройро░рпН ${i + 1}/${totalUsers} | роорпКродрпНрод рокроЩрпНроХро│ро┐рокрпНрокрпБроХро│рпН: ${totalContributions}`
                    );
                    
                    try {
                        const userContribs = await this.fetchCompleteUserContributions(username, startDate, endDate);
                        totalAPICalls += userContribs.apiCalls || 0;
                        
                        if (userContribs.contributions && userContribs.contributions.length > 0) {
                            this.addContributions(username, userContribs.contributions);
                            totalContributions += userContribs.contributions.length;
                            
                            this.showStatus(
                                `${username}: ${userContribs.contributions.length} рокроЩрпНроХро│ро┐рокрпНрокрпБроХро│рпН (API роЕро┤рпИрокрпНрокрпБроХро│рпН: ${userContribs.apiCalls})`, 
                                'success'
                            );
                            
                            // API rate limiting роРродрпН родро╡ро┐ро░рпНроХрпНроХ
                            await this.delay(500);
                            
                        } else {
                            this.showStatus(`${username}: рокроЩрпНроХро│ро┐рокрпНрокрпБроХро│рпН роХро┐роЯрпИроХрпНроХро╡ро┐ро▓рпНро▓рпИ`, 'info');
                        }
                        
                    } catch (error) {
                        console.error(`${username} рокро┐ро┤рпИ:`, error);
                        this.showStatus(`${username}: родро╡ро▒рпБ - ${error.message}`, 'error');
                    }
                }
                
                this.showLoading(false);
                
                showStatus(
                    `рокроХрпБрокрпНрокро╛ропрпНро╡рпБ роорпБроЯро┐роирпНродродрпБ! ${totalContributions} роорпКродрпНрод рокроЩрпНроХро│ро┐рокрпНрокрпБроХро│рпН, ${totalAPICalls} API роЕро┤рпИрокрпНрокрпБроХро│рпН`, 
                    'success'
                );
                
                return this.generateReport(startDate, endDate, totalContributions, totalAPICalls);
            }

            async fetchCompleteUserContributions(username, startDate, endDate) {
                const allContributions = [];
                let totalAPICalls = 0;
                
                // роТро╡рпНро╡рпКро░рпБ родро┐роЯрпНроЯродрпНродро┐ро▒рпНроХрпБроорпН рокроЩрпНроХро│ро┐рокрпНрокрпБроХро│рпИрокрпН рокрпЖро▒рпБроХ
                for (const project of this.selectedProjects) {
                    try {
                        const projectResult = await this.fetchContributionsWithPagination(
                            username, 
                            project.domain, 
                            startDate, 
                            endDate
                        );
                        
                        allContributions.push(...projectResult.contributions.map(contrib => ({
                            ...contrib,
                            project: project.name,
                            projectDomain: project.domain
                        })));
                        
                        totalAPICalls += projectResult.apiCalls;
                        
                    } catch (error) {
                        console.warn(`${username} - ${project.name}: ${error.message}`);
                    }
                }
                
                return {
                    contributions: allContributions,
                    apiCalls: totalAPICalls
                };
            }

            async fetchContributionsWithPagination(username, domain, startDate, endDate) {
                const allContributions = [];
                let continueToken = null;
                let apiCalls = 0;
                let pageCount = 0;
                const maxPages = 10; // роЕродро┐роХрокроЯрпНроЪроорпН 10 рокроХрпНроХроЩрпНроХро│рпН (5000 * 10 = 50,000 родро┐ро░рпБродрпНродроЩрпНроХро│рпН)
                
                do {
                    try {
                        const result = await this.fetchContributionsPage(
                            username, 
                            domain, 
                            startDate, 
                            endDate, 
                            continueToken
                        );
                        
                        allContributions.push(...result.contributions);
                        continueToken = result.continue;
                        apiCalls++;
                        pageCount++;
                        
                        this.updateProgressDetails(
                            `${username} - ${domain}: рокроХрпНроХроорпН ${pageCount}, роорпКродрпНродроорпН ${allContributions.length} родро┐ро░рпБродрпНродроЩрпНроХро│рпН`
                        );
                        
                        // API роорпАродрпБ роЕро┤рпБродрпНродроорпН роХрпБро▒рпИроХрпНроХ
                        if (pageCount < maxPages) {
                            await this.delay(200);
                        } else {
                            break; // роЕродро┐роХрокроЯрпНроЪ рокроХрпНроХ роОрогрпНрогро┐роХрпНроХрпИропрпИ роЕроЯрпИроирпНродрпБро╡ро┐роЯрпНроЯродрпБ
                        }
                        
                    } catch (error) {
                        console.error(`${username} - ${domain} рокроХрпНроХроорпН ${pageCount + 1}: ${error.message}`);
                        break;
                    }
                    
                } while (continueToken && pageCount < maxPages && allContributions.length < this.contributionLimit);
                
                return {
                    contributions: allContributions.slice(0, this.contributionLimit),
                    apiCalls: apiCalls
                };
            }

            async fetchContributionsPage(username, domain, startDate, endDate, continueToken = null) {
                const apiUrl = `https://${domain}/w/api.php`;
                
                // роЕройрпИродрпНродрпБ ро╡ро┐ро░рпБрокрпНрокроЩрпНроХро│рпИропрпБроорпН роЙро│рпНро│роЯроХрпНроХро┐роп роЕро│ро╡рпБро░рпБроХрпНроХро│рпН
                const params = new URLSearchParams({
                    action: 'query',
                    list: 'usercontribs',
                    ucuser: username,
                    ucstart: startDate + 'T00:00:00Z',
                    ucend: endDate + 'T23:59:59Z',
                    uclimit: '500', // роТро░рпБ рокроХрпНроХродрпНродро┐ро▒рпНроХрпБ роЕродро┐роХрокроЯрпНроЪроорпН
                    ucprop: 'title|timestamp|comment|size|sizediff|flags|ids|tags',
                    format: 'json',
                    origin: '*'
                });
                
                // роЪро┐ро▒рпБ родро┐ро░рпБродрпНродроЩрпНроХро│рпИроЪрпН роЪрпЗро░рпНроХрпНроХ
                if (includeMinor.checked) {
                    params.append('ucshow', '!minor');
                } else {
                    params.append('ucshow', 'minor');
                }
                
                // рокро╛роЯрпН родро┐ро░рпБродрпНродроЩрпНроХро│рпИроЪрпН роЪрпЗро░рпНроХрпНроХ
                if (includeBot.checked) {
                    params.append('ucshow', '!bot');
                } else {
                    params.append('ucshow', 'bot');
                }
                
                // Continue token роЪрпЗро░рпНроХрпНроХ
                if (continueToken) {
                    params.append('uccontinue', continueToken);
                }
                
                try {
                    const proxyUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(apiUrl + '?' + params)}`;
                    
                    const response = await fetch(proxyUrl, {
                        headers: {
                            'User-Agent': 'WikimediaCompleteAnalyzer/3.0',
                            'Accept': 'application/json'
                        }
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}`);
                    }
                    
                    const data = await response.json();
                    const jsonData = JSON.parse(data.contents);
                    
                    if (jsonData.error) {
                        throw new Error(jsonData.error.info);
                    }
                    
                    const contributions = jsonData.query?.usercontribs || [];
                    const continueData = jsonData.continue?.uccontinue;
                    
                    return {
                        contributions: contributions,
                        continue: continueData
                    };
                    
                } catch (error) {
                    console.error(`API рокро┐ро┤рпИ: ${error.message}`);
                    throw error;
                }
            }

            addContributions(username, contributions) {
                if (!this.userStats.has(username)) {
                    this.userStats.set(username, {
                        total: 0,
                        minor: 0,
                        bot: 0,
                        new: 0,
                        projects: new Map(),
                        contributions: [],
                        details: {
                            byHour: new Map(),
                            byDay: new Map(),
                            byProject: new Map()
                        }
                    });
                }
                
                const userStat = this.userStats.get(username);
                
                contributions.forEach(contrib => {
                    userStat.total++;
                    
                    // ро╡ро┐ро╡ро░роЩрпНроХро│рпИрокрпН рокрпБродрпБрокрпНрокро┐роХрпНроХро╡рпБроорпН
                    if (contrib.minor) userStat.minor++;
                    if (contrib.bot) userStat.bot++;
                    if (contrib.new) userStat.new++;
                    
                    userStat.contributions.push(contrib);
                    
                    // родро┐роЯрпНроЯроорпН ро╡ро╛ро░ро┐ропро╛рой рокрпБро│рпНро│ро┐ро╡ро┐ро╡ро░роЩрпНроХро│рпН
                    const project = contrib.project;
                    if (!userStat.projects.has(project)) {
                        userStat.projects.set(project, 0);
                    }
                    userStat.projects.set(project, userStat.projects.get(project) + 1);
                    
                    // роХро╛ро▓ роЕроЯро┐рокрпНрокроЯрпИропро┐ро▓рпН рокрпБро│рпНро│ро┐ро╡ро┐ро╡ро░роЩрпНроХро│рпН
                    const timestamp = new Date(contrib.timestamp);
                    const hour = timestamp.getHours();
                    const day = timestamp.toISOString().split('T')[0];
                    
                    if (!userStat.details.byHour.has(hour)) {
                        userStat.details.byHour.set(hour, 0);
                    }
                    userStat.details.byHour.set(hour, userStat.details.byHour.get(hour) + 1);
                    
                    if (!userStat.details.byDay.has(day)) {
                        userStat.details.byDay.set(day, 0);
                    }
                    userStat.details.byDay.set(day, userStat.details.byDay.get(day) + 1);
                    
                    // роорпКродрпНрод родро┐роЯрпНроЯ рокрпБро│рпНро│ро┐ро╡ро┐ро╡ро░роЩрпНроХро│рпН
                    if (!this.projects.has(project)) {
                        this.projects.set(project, {
                            total: 0,
                            contributors: new Set(),
                            contributions: []
                        });
                    }
                    
                    const projectStat = this.projects.get(project);
                    projectStat.total++;
                    projectStat.contributors.add(username);
                    projectStat.contributions.push({
                        username,
                        ...contrib
                    });
                });
            }

            generateReport(startDate, endDate, totalContributions, totalAPICalls) {
                const report = {
                    summary: {
                        totalParticipants: this.userStats.size,
                        totalProjects: this.projects.size,
                        totalContributions: totalContributions,
                        totalAPICalls: totalAPICalls,
                        period: { start: startDate, end: endDate },
                        settings: {
                            projects: this.selectedProjects.map(p => p.name),
                            contributionLimit: this.contributionLimit,
                            includeMinor: includeMinor.checked,
                            includeBot: includeBot.checked
                        }
                    },
                    participants: [],
                    projects: [],
                    topContributors: [],
                    detailedStats: {
                        byHour: [],
                        byDay: [],
                        byProjectType: []
                    }
                };
                
                // рокроЩрпНроХро│ро┐рокрпНрокро╛ро│ро░рпН ро╡ро┐ро╡ро░роЩрпНроХро│рпН
                this.userStats.forEach((stats, username) => {
                    const projectsArray = Array.from(stats.projects.entries())
                        .map(([project, count]) => ({ project, count }))
                        .sort((a, b) => b.count - a.count);
                    
                    report.participants.push({
                        username,
                        total: stats.total,
                        minor: stats.minor,
                        bot: stats.bot,
                        new: stats.new,
                        projects: projectsArray,
                        projectCount: stats.projects.size,
                        contributions: stats.contributions,
                        details: {
                            byHour: Array.from(stats.details.byHour.entries())
                                .sort((a, b) => a[0] - b[0])
                                .map(([hour, count]) => ({ hour, count })),
                            byDay: Array.from(stats.details.byDay.entries())
                                .sort((a, b) => a[0].localeCompare(b[0]))
                                .map(([day, count]) => ({ day, count }))
                        }
                    });
                });
                
                report.participants.sort((a, b) => b.total - a.total);
                
                // родро┐роЯрпНроЯ рокрпБро│рпНро│ро┐ро╡ро┐ро╡ро░роЩрпНроХро│рпН
                this.projects.forEach((stats, project) => {
                    report.projects.push({
                        project,
                        totalContributions: stats.total,
                        uniqueContributors: stats.contributors.size,
                        avgPerContributor: stats.total / stats.contributors.size,
                        contributions: stats.contributions
                    });
                });
                
                report.projects.sort((a, b) => b.totalContributions - a.totalContributions);
                report.topContributors = report.participants.slice(0, 10);
                
                // роХро╛ро▓ роЕроЯро┐рокрпНрокроЯрпИропро┐ро▓рпН рокрпБро│рпНро│ро┐ро╡ро┐ро╡ро░роЩрпНроХро│рпН
                const allByHour = new Map();
                const allByDay = new Map();
                
                this.userStats.forEach(stats => {
                    stats.details.byHour.forEach((count, hour) => {
                        if (!allByHour.has(hour)) allByHour.set(hour, 0);
                        allByHour.set(hour, allByHour.get(hour) + count);
                    });
                    
                    stats.details.byDay.forEach((count, day) => {
                        if (!allByDay.has(day)) allByDay.set(day, 0);
                        allByDay.set(day, allByDay.get(day) + count);
                    });
                });
                
                report.detailedStats.byHour = Array.from(allByHour.entries())
                    .sort((a, b) => a[0] - b[0])
                    .map(([hour, count]) => ({ hour, count }));
                
                report.detailedStats.byDay = Array.from(allByDay.entries())
                    .sort((a, b) => a[0].localeCompare(b[0]))
                    .map(([day, count]) => ({ day, count }));
                
                return report;
            }

            displayReport(report, containerId) {
                const container = document.getElementById(containerId);
                
                let html = `
                    <div class="results-container">
                        <div class="results-header">
                            <div>
                                <h2 class="results-title">ЁЯУК роорпБро┤рпБроорпИропро╛рой рокроЩрпНроХро│ро┐рокрпНрокрпБ рокроХрпБрокрпНрокро╛ропрпНро╡рпБ роорпБроЯро┐ро╡рпБроХро│рпН</h2>
                                <p style="color: var(--text-light); margin-top: 5px;">
                                    ${report.summary.period.start} роорпБродро▓рпН ${report.summary.period.end} ро╡ро░рпИ
                                </p>
                            </div>
                            <div class="results-actions">
                                <button class="export-btn" onclick="exportFullReport()">
                                    ЁЯУД роорпБро┤рпБ роЕро▒ро┐роХрпНроХрпИ
                                </button>
                                <button class="export-btn" onclick="window.print()">
                                    ЁЯЦия╕П роЕроЪрпНроЪро┐роЯрпБроХ
                                </button>
                            </div>
                        </div>
                        
                        <div class="results-grid">
                            <div class="results-card">
                                <h3>ЁЯУИ роорпКродрпНрод рокрпБро│рпНро│ро┐ро╡ро┐ро╡ро░роЩрпНроХро│рпН</h3>
                                <div style="margin-bottom: 20px;">
                                    <div class="stats-value">${report.summary.totalContributions.toLocaleString()}</div>
                                    <div class="stats-label">роорпКродрпНрод рокроЩрпНроХро│ро┐рокрпНрокрпБроХро│рпН</div>
                                </div>
                                
                                <div class="detailed-stats">
                                    <h4>ро╡ро┐ро░ро┐ро╡ро╛рой рокрпБро│рпНро│ро┐ро╡ро┐ро╡ро░роЩрпНроХро│рпН</h4>
                                    <div class="stat-row">
                                        <span class="stat-category">рокроЩрпНроХро│ро┐рокрпНрокро╛ро│ро░рпНроХро│рпН:</span>
                                        <span class="stat-number">${report.summary.totalParticipants}</span>
                                    </div>
                                    <div class="stat-row">
                                        <span class="stat-category">родро┐роЯрпНроЯроЩрпНроХро│рпН:</span>
                                        <span class="stat-number">${report.summary.totalProjects}</span>
                                    </div>
                                    <div class="stat-row">
                                        <span class="stat-category">API роЕро┤рпИрокрпНрокрпБроХро│рпН:</span>
                                        <span class="stat-number">${report.summary.totalAPICalls}</span>
                                    </div>
                                    <div class="stat-row">
                                        <span class="stat-category">роЪро┐ро▒рпБ родро┐ро░рпБродрпНродроЩрпНроХро│рпН:</span>
                                        <span class="stat-number">${report.participants.reduce((sum, p) => sum + p.minor, 0).toLocaleString()}</span>
                                    </div>
                                    <div class="stat-row">
                                        <span class="stat-category">рокрпБродро┐роп рокроХрпНроХроЩрпНроХро│рпН:</span>
                                        <span class="stat-number">${report.participants.reduce((sum, p) => sum + p.new, 0).toLocaleString()}</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="results-card">
                                <h3>ЁЯСе роорпБройрпНройрогро┐ рокроЩрпНроХро│ро┐рокрпНрокро╛ро│ро░рпНроХро│рпН</h3>
                                <div class="contributor-list">
                `;
                
                report.topContributors.forEach((contributor, index) => {
                    const medal = index === 0 ? 'ЁЯеЗ' : index === 1 ? 'ЁЯеИ' : index === 2 ? 'ЁЯеЙ' : `${index + 1}.`;
                    const minorPercent = contributor.total > 0 ? Math.round((contributor.minor / contributor.total) * 100) : 0;
                    
                    html += `
                        <div class="contributor-item">
                            <div>
                                <div class="contributor-name">${medal} ${contributor.username}</div>
                                <div class="contributor-details">
                                    <div class="detail-item">
                                        <div class="detail-label">роорпКродрпНродроорпН</div>
                                        <div class="detail-value">${contributor.total.toLocaleString()}</div>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-label">роЪро┐ро▒рпБ родро┐ро░рпБродрпНродроЩрпНроХро│рпН</div>
                                        <div class="detail-value">${contributor.minor.toLocaleString()} (${minorPercent}%)</div>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-label">родро┐роЯрпНроЯроЩрпНроХро│рпН</div>
                                        <div class="detail-value">${contributor.projectCount}</div>
                                    </div>
                                </div>
                            </div>
                            <div class="contributor-count">${contributor.total.toLocaleString()}</div>
                        </div>
                    `;
                });
                
                html += `
                                </div>
                            </div>
                            
                            <div class="results-card">
                                <h3>ЁЯПЧя╕П родро┐роЯрпНроЯроорпН ро╡ро╛ро░ро┐ропро╛рой рокроЩрпНроХро│ро┐рокрпНрокрпБроХро│рпН</h3>
                                <div class="project-breakdown">
                `;
                
                report.projects.slice(0, 8).forEach(project => {
                    const percentage = (project.totalContributions / report.summary.totalContributions * 100).toFixed(1);
                    
                    html += `
                        <div class="project-item">
                            <span>${project.project}</span>
                            <div style="display: flex; align-items: center; gap: 15px;">
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: ${percentage}%"></div>
                                </div>
                                <span style="font-weight: 600; color: var(--primary); min-width: 80px; text-align: right;">
                                    ${project.totalContributions.toLocaleString()}
                                </span>
                            </div>
                        </div>
                    `;
                });
                
                if (report.projects.length > 8) {
                    html += `
                        <div style="text-align: center; padding: 10px; color: var(--text-light); font-size: 14px;">
                            + ${report.projects.length - 8} роорпЗро▓рпБроорпН родро┐роЯрпНроЯроЩрпНроХро│рпН
                        </div>
                    `;
                }
                
                html += `
                                </div>
                            </div>
                            
                            <div class="results-card">
                                <h3>ЁЯУЕ роХро╛ро▓ роЕроЯро┐рокрпНрокроЯрпИропро┐ро▓рпН рокроЩрпНроХро│ро┐рокрпНрокрпБроХро│рпН</h3>
                                <div class="timeline-chart" id="timelineChart">
                                    <!-- роХро╛ро▓роХрпНроХрпЛроЯрпБ ро╡ро░рпИрокроЯроорпН -->
                                </div>
                                <div style="margin-top: 20px;">
                                    <h4>роЕродро┐роХ рокроЩрпНроХро│ро┐рокрпНрокрпБ роирпЗро░роЩрпНроХро│рпН</h4>
                                    <div class="detailed-stats">
                `;
                
                // роЕродро┐роХрооро╛рой рокроЩрпНроХро│ро┐рокрпНрокрпБ роирпЗро░роЩрпНроХро│рпН
                const topHours = report.detailedStats.byHour
                    .sort((a, b) => b.count - a.count)
                    .slice(0, 5);
                
                topHours.forEach(hour => {
                    const hourLabel = `${hour.hour}:00 - ${hour.hour + 1}:00`;
                    html += `
                        <div class="stat-row">
                            <span class="stat-category">${hourLabel}</span>
                            <span class="stat-number">${hour.count.toLocaleString()}</span>
                        </div>
                    `;
                });
                
                html += `
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="results-card" style="grid-column: 1 / -1;">
                            <h3>ЁЯУЛ роорпБро┤рпБроорпИропро╛рой рокроЩрпНроХро│ро┐рокрпНрокро╛ро│ро░рпН рокроЯрпНроЯро┐ропро▓рпН</h3>
                            <div class="contrib-type-filter">
                                <button class="type-filter-btn active" onclick="filterContributors('all')">роЕройрпИродрпНродрпБроорпН</button>
                                <button class="type-filter-btn" onclick="filterContributors('minor')">роЪро┐ро▒рпБ родро┐ро░рпБродрпНродроЩрпНроХро│рпН</button>
                                <button class="type-filter-btn" onclick="filterContributors('new')">рокрпБродро┐роп рокроХрпНроХроЩрпНроХро│рпН</button>
                                <button class="type-filter-btn" onclick="filterContributors('multiple')">рокро▓ родро┐роЯрпНроЯроЩрпНроХро│рпН</button>
                            </div>
                            <div style="overflow-x: auto;">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>рокроЩрпНроХро│ро┐рокрпНрокро╛ро│ро░рпН</th>
                                            <th>роорпКродрпНрод рокроЩрпНроХро│ро┐рокрпНрокрпБроХро│рпН</th>
                                            <th>роЪро┐ро▒рпБ родро┐ро░рпБродрпНродроЩрпНроХро│рпН</th>
                                            <th>рокрпБродро┐роп рокроХрпНроХроЩрпНроХро│рпН</th>
                                            <th>родро┐роЯрпНроЯроЩрпНроХро│рпН</th>
                                            <th>роорпБроХрпНроХро┐роп родро┐роЯрпНроЯроЩрпНроХро│рпН</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                `;
                
                report.participants.forEach(contributor => {
                    const topProjects = contributor.projects
                        .slice(0, 2)
                        .map(p => `<span class="badge badge-primary">${p.project}: ${p.count.toLocaleString()}</span>`)
                        .join(' ');
                    
                    const minorPercent = contributor.total > 0 ? Math.round((contributor.minor / contributor.total) * 100) : 0;
                    const newPercent = contributor.total > 0 ? Math.round((contributor.new / contributor.total) * 100) : 0;
                    
                    html += `
                        <tr>
                            <td><strong>${contributor.username}</strong></td>
                            <td><span class="badge badge-success">${contributor.total.toLocaleString()}</span></td>
                            <td>
                                <span class="badge badge-${minorPercent > 50 ? 'warning' : 'info'}">
                                    ${contributor.minor.toLocaleString()} (${minorPercent}%)
                                </span>
                            </td>
                            <td>
                                <span class="badge badge-accent">
                                    ${contributor.new.toLocaleString()} (${newPercent}%)
                                </span>
                            </td>
                            <td>${contributor.projectCount}</td>
                            <td>${topProjects}</td>
                        </tr>
                    `;
                });
                
                html += `
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <div class="export-section">
                            <h3>ЁЯТ╛ роорпБроЯро┐ро╡рпБроХро│рпИ роПро▒рпНро▒рпБроородро┐ роЪрпЖропрпНроХ</h3>
                            <div class="export-buttons">
                                <button class="export-btn" onclick="exportToJSON()">
                                    ЁЯУК JSON родро░ро╡рпБроХро│рпН
                                </button>
                                <button class="export-btn" onclick="exportToCSV()">
                                    ЁЯУИ CSV роЕро▒ро┐роХрпНроХрпИ
                                </button>
                                <button class="export-btn" onclick="exportToHTML()">
                                    ЁЯУД HTML роЕро▒ро┐роХрпНроХрпИ
                                </button>
                                <button class="export-btn" onclick="exportRawData()">
                                    ЁЯФН роорпВро▓ родро░ро╡рпБроХро│рпН
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                container.innerHTML = html;
                
                // роХро╛ро▓роХрпНроХрпЛроЯрпБ ро╡ро░рпИрокроЯродрпНродрпИ роЙро░рпБро╡ро╛роХрпНроХрпБроХ
                this.renderTimelineChart(report.detailedStats.byDay);
                
                // роорпБро┤рпБ роЕро▒ро┐роХрпНроХрпИропрпИ роЪрпЗрооро┐роХрпНроХро╡рпБроорпН
                window.lastFullReport = report;
            }

            renderTimelineChart(byDayData) {
                const chartContainer = document.getElementById('timelineChart');
                if (!chartContainer || byDayData.length === 0) return;
                
                const maxCount = Math.max(...byDayData.map(d => d.count));
                const chartHeight = 150;
                const barWidth = Math.max(20, (chartContainer.clientWidth - 100) / byDayData.length);
                
                chartContainer.innerHTML = '';
                
                byDayData.forEach((dayData, index) => {
                    const barHeight = (dayData.count / maxCount) * chartHeight;
                    const left = index * (barWidth + 5) + 30;
                    
                    const bar = document.createElement('div');
                    bar.className = 'chart-bar';
                    bar.style.left = `${left}px`;
                    bar.style.width = `${barWidth}px`;
                    bar.style.height = `${barHeight}px`;
                    bar.title = `${dayData.day}: ${dayData.count.toLocaleString()} рокроЩрпНроХро│ро┐рокрпНрокрпБроХро│рпН`;
                    
                    const label = document.createElement('div');
                    label.className = 'chart-label';
                    label.style.left = `${left}px`;
                    label.textContent = dayData.day.split('-').slice(1).join('-');
                    
                    chartContainer.appendChild(bar);
                    chartContainer.appendChild(label);
                });
            }

            showLoading(show, message, details) {
                updateProgress(show ? 0 : 100, message, details);
            }

            updateProgressDetails(details) {
                loadingDetails.textContent = details;
            }

            showStatus(message, type) {
                showStatus(message, type);
            }

            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }
        
        // роПро▒рпНро▒рпБроородро┐ роЪрпЖропро▓рпНрокро╛роЯрпБроХро│рпН
        function exportFullReport() {
            if (!window.lastFullReport) {
                showStatus('роорпБродро▓ро┐ро▓рпН рокроХрпБрокрпНрокро╛ропрпНро╡рпИ роЗропроХрпНроХро╡рпБроорпН', 'warning');
                return;
            }
            
            const report = window.lastFullReport;
            const jsonString = JSON.stringify(report, null, 2);
            downloadFile(jsonString, `wikimedia-full-report-${new Date().toISOString().slice(0,10)}.json`, 'application/json');
        }
        
        function exportToJSON() {
            if (!window.lastFullReport) {
                showStatus('роорпБродро▓ро┐ро▓рпН рокроХрпБрокрпНрокро╛ропрпНро╡рпИ роЗропроХрпНроХро╡рпБроорпН', 'warning');
                return;
            }
            
            const simplified = {
                summary: window.lastFullReport.summary,
                participants: window.lastFullReport.participants.map(p => ({
                    username: p.username,
                    total: p.total,
                    minor: p.minor,
                    new: p.new,
                    projectCount: p.projectCount,
                    projects: p.projects
                })),
                generated: new Date().toISOString()
            };
            
            const jsonString = JSON.stringify(simplified, null, 2);
            downloadFile(jsonString, 'wikimedia-contributions.json', 'application/json');
        }
        
        function exportToCSV() {
            if (!window.lastFullReport) {
                showStatus('роорпБродро▓ро┐ро▓рпН рокроХрпБрокрпНрокро╛ропрпНро╡рпИ роЗропроХрпНроХро╡рпБроорпН', 'warning');
                return;
            }
            
            let csv = 'рокроЩрпНроХро│ро┐рокрпНрокро╛ро│ро░рпН,роорпКродрпНрод рокроЩрпНроХро│ро┐рокрпНрокрпБроХро│рпН,роЪро┐ро▒рпБ родро┐ро░рпБродрпНродроЩрпНроХро│рпН,рокрпБродро┐роп рокроХрпНроХроЩрпНроХро│рпН,родро┐роЯрпНроЯроЩрпНроХро│рпН,родро┐роЯрпНроЯ ро╡ро┐ро╡ро░роЩрпНроХро│рпН\n';
            
            window.lastFullReport.participants.forEach(p => {
                const projectDetails = p.projects
                    .map(proj => `${proj.project}:${proj.count}`)
                    .join('; ');
                csv += `"${p.username}",${p.total},${p.minor},${p.new},${p.projectCount},"${projectDetails}"\n`;
            });
            
            downloadFile(csv, 'wikimedia-contributions.csv', 'text/csv');
        }
        
        function exportToHTML() {
            if (!window.lastFullReport) {
                showStatus('роорпБродро▓ро┐ро▓рпН рокроХрпБрокрпНрокро╛ропрпНро╡рпИ роЗропроХрпНроХро╡рпБроорпН', 'warning');
                return;
            }
            
            const report = window.lastFullReport;
            const html = generateHTMLReport(report);
            downloadFile(html, 'wikimedia-contributions.html', 'text/html');
        }
        
        function exportRawData() {
            if (!window.lastFullReport) {
                showStatus('роорпБродро▓ро┐ро▓рпН рокроХрпБрокрпНрокро╛ропрпНро╡рпИ роЗропроХрпНроХро╡рпБроорпН', 'warning');
                return;
            }
            
            const rawData = {
                contributions: [],
                generated: new Date().toISOString()
            };
            
            window.lastFullReport.participants.forEach(p => {
                p.contributions.forEach(c => {
                    rawData.contributions.push({
                        username: p.username,
                        project: c.project,
                        title: c.title,
                        timestamp: c.timestamp,
                        size: c.size,
                        minor: c.minor || false,
                        new: c.new || false
                    });
                });
            });
            
            const jsonString = JSON.stringify(rawData, null, 2);
            downloadFile(jsonString, 'wikimedia-raw-data.json', 'application/json');
        }
        
        function generateHTMLReport(report) {
            return `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>ро╡ро┐роХрпНроХро┐роорпАроЯро┐ропро╛ рокроЩрпНроХро│ро┐рокрпНрокрпБ роЕро▒ро┐роХрпНроХрпИ</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 30px; }
                        h1, h2, h3 { color: #1a237e; }
                        table { border-collapse: collapse; width: 100%; margin: 20px 0; }
                        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
                        th { background: #1a237e; color: white; }
                        .stat { background: #f8f9fa; padding: 20px; margin: 10px; border-radius: 8px; }
                        .badge { background: #1a237e; color: white; padding: 3px 8px; border-radius: 4px; font-size: 12px; }
                    </style>
                </head>
                <body>
                    <h1>ро╡ро┐роХрпНроХро┐роорпАроЯро┐ропро╛ рокроЩрпНроХро│ро┐рокрпНрокрпБ роЕро▒ро┐роХрпНроХрпИ</h1>
                    <p>роХро╛ро▓роорпН: ${report.summary.period.start} роорпБродро▓рпН ${report.summary.period.end} ро╡ро░рпИ</p>
                    
                    <div style="display: flex; gap: 20px; margin: 30px 0;">
                        <div class="stat">
                            <h3>${report.summary.totalContributions.toLocaleString()}</h3>
                            <p>роорпКродрпНрод рокроЩрпНроХро│ро┐рокрпНрокрпБроХро│рпН</p>
                        </div>
                        <div class="stat">
                            <h3>${report.summary.totalParticipants}</h3>
                            <p>рокроЩрпНроХро│ро┐рокрпНрокро╛ро│ро░рпНроХро│рпН</p>
                        </div>
                        <div class="stat">
                            <h3>${report.summary.totalProjects}</h3>
                            <p>родро┐роЯрпНроЯроЩрпНроХро│рпН</p>
                        </div>
                    </div>
                    
                    <h2>рокроЩрпНроХро│ро┐рокрпНрокро╛ро│ро░рпНроХро│рпН</h2>
                    <table>
                        <tr>
                            <th>рокроЩрпНроХро│ро┐рокрпНрокро╛ро│ро░рпН</th>
                            <th>роорпКродрпНродроорпН</th>
                            <th>роЪро┐ро▒рпБ родро┐ро░рпБродрпНродроЩрпНроХро│рпН</th>
                            <th>рокрпБродро┐роп рокроХрпНроХроЩрпНроХро│рпН</th>
                            <th>родро┐роЯрпНроЯроЩрпНроХро│рпН</th>
                        </tr>
                        ${report.participants.map(p => `
                            <tr>
                                <td>${p.username}</td>
                                <td><span class="badge">${p.total.toLocaleString()}</span></td>
                                <td>${p.minor.toLocaleString()}</td>
                                <td>${p.new.toLocaleString()}</td>
                                <td>${p.projectCount}</td>
                            </tr>
                        `).join('')}
                    </table>
                    
                    <h2>родро┐роЯрпНроЯроЩрпНроХро│рпН</h2>
                    <table>
                        <tr>
                            <th>родро┐роЯрпНроЯроорпН</th>
                            <th>роорпКродрпНрод рокроЩрпНроХро│ро┐рокрпНрокрпБроХро│рпН</th>
                            <th>родройро┐рокрпНрокроЯрпНроЯ рокроЩрпНроХро│ро┐рокрпНрокро╛ро│ро░рпНроХро│рпН</th>
                        </tr>
                        ${report.projects.map(p => `
                            <tr>
                                <td>${p.project}</td>
                                <td>${p.totalContributions.toLocaleString()}</td>
                                <td>${p.uniqueContributors}</td>
                            </tr>
                        `).join('')}
                    </table>
                    
                    <p style="margin-top: 50px; color: #666; font-size: 12px;">
                        роЙро░рпБро╡ро╛роХрпНроХрокрпНрокроЯрпНроЯродрпБ: ${new Date().toLocaleString('ta-IN')} | 
                        API роЕро┤рпИрокрпНрокрпБроХро│рпН: ${report.summary.totalAPICalls}
                    </p>
                </body>
                </html>
            `;
        }
        
        function downloadFile(content, filename, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showStatus(`${filename} рокродро┐ро╡ро┐ро▒роХрпНроХроорпН роЪрпЖропрпНропрокрпНрокроЯрпНроЯродрпБ`, 'success');
        }
        
        // рокроЩрпНроХро│ро┐рокрпНрокро╛ро│ро░рпН ро╡роЯро┐роХроЯрпНроЯрпБродро▓рпН
        function filterContributors(type) {
            const buttons = document.querySelectorAll('.type-filter-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // роЗроЩрпНроХрпЗ ро╡роЯро┐роХроЯрпНроЯрпБродро▓рпН родро░рпБроХрпНроХродрпНродрпИроЪрпН роЪрпЗро░рпНроХрпНроХро▓ро╛роорпН
            showStatus(`${type} ро╡роЯро┐роХроЯрпНроЯро▓рпН рокропройрпНрокроЯрпБродрпНродрокрпНрокроЯрпБроХро┐ро▒родрпБ`, 'info');
        }
    </script>
</body>
</html>
